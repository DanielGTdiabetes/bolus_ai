const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CjLpWvmv.js","assets/index-Bm9BGgrl.css"])))=>i.map(i=>d[i]);
import{r,j as e,g as oe,s as ce,d as xe,H as L,B as M,a as W,f as re,C as T,I as B,b as v,c as de,e as K,h as ee,_ as V,t as ye,i as be,k as je,l as ve,n as D,m as ue,o as me,p as Se,q as Ce,R as ge,u as f,v as we,w as ke,x as _e,y as Ne,z as Be,A as te,D as ze,E as le,F as ae,G as Re,J as Te,K as Ae,L as Ie,M as Pe,N as De,O as Ee,P as Le,Q as pe,S as We,T as Fe,U as Me,V as Oe,W as Y,X as he,Y as Ue,Z as $e,$ as Ge,a0 as He}from"./index-CjLpWvmv.js";function qe(){const[t,a]=r.useState(""),[n,i]=r.useState(""),[d,u]=r.useState(!1),[s,l]=r.useState(!1),[c,g]=r.useState("");r.useEffect(()=>{async function o(){try{const h=await oe();a(h.url||""),u(h.enabled),l(h.has_secret)}catch(h){console.error("Failed to load Nightscout secret status",h)}}o()},[]);const m=async o=>{o.preventDefault();try{await ce({url:t,api_secret:n,enabled:d}),g("ConfiguraciÃ³n guardada correctamente"),l(!0)}catch{g("Error al guardar la configuraciÃ³n")}},p=async()=>{try{await xe(),a(""),i(""),u(!1),l(!1),g("Credenciales eliminadas")}catch{g("Error al eliminar credenciales")}};return e.jsxs("div",{className:"nightscout-settings container mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"ConfiguraciÃ³n Nightscout"}),c&&e.jsx("p",{className:"mb-2 text-green-600",children:c}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"URL de Nightscout"}),e.jsx("input",{type:"text",value:t,onChange:o=>a(o.target.value),className:"w-full border rounded p-2",placeholder:"https://mi-nightscout.example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Clave API (API Secret)"}),e.jsx("input",{type:"password",value:n,onChange:o=>i(o.target.value),className:"w-full border rounded p-2",placeholder:"Tu token o secreto de Nightscout",required:!0})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:o=>u(o.target.checked),id:"enabled",className:"mr-2"}),e.jsx("label",{htmlFor:"enabled",className:"font-medium",children:"Habilitado"})]}),e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700",children:"Guardar"}),s&&e.jsx("button",{type:"button",onClick:p,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 ml-4",children:"Borrar Credenciales"})]})]})}function Ve(){const[t,a]=r.useState(!0),[n,i]=r.useState(null),[d,u]=r.useState([]),[s,l]=r.useState({insulin:0,carbs:0});return r.useEffect(()=>{let c=!0;return(async()=>{try{const m=W()||{},p=await re({...m,count:50});if(!c)return;const o=new Date().toDateString();let h=0,S=0;const y=p.filter(x=>{const w=parseFloat(x.insulin)||0,b=parseFloat(x.carbs)||0,k=w>0||b>0;return k&&new Date(x.created_at||x.timestamp||x.date).toDateString()===o&&(w>0&&(h+=w),b>0&&(S+=b)),k});u(y),l({insulin:h,carbs:S}),a(!1)}catch(m){c&&(i(m.message),a(!1))}})(),()=>{c=!1}},[]),e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Historial",showBack:!0}),e.jsxs("main",{className:"page fade-in",style:{paddingBottom:"80px"},children:[e.jsxs("div",{className:"metrics-grid",children:[e.jsxs("div",{className:"metric-tile",style:{background:"#eff6ff",textAlign:"center",padding:"1.5rem 0.5rem",borderRadius:"12px"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:800,color:"#2563eb"},children:t?"--":s.insulin.toFixed(1)}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#93c5fd",fontWeight:700},children:"INSULINA HOY"})]}),e.jsxs("div",{className:"metric-tile",style:{background:"#fff7ed",textAlign:"center",padding:"1.5rem 0.5rem",borderRadius:"12px"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:800,color:"#f97316"},children:t?"--":Math.round(s.carbs)}),e.jsx("div",{style:{fontSize:"0.7rem",color:"#fdba74",fontWeight:700},children:"CARBOS HOY"})]})]}),e.jsx("h4",{style:{marginBottom:"1rem",color:"var(--text-muted)"},children:"Ãšltimas Transacciones"}),e.jsxs("div",{className:"activity-list",children:[t&&e.jsx("div",{className:"spinner",children:"Cargando..."}),n&&e.jsx("div",{className:"error-msg",style:{color:"var(--danger)",padding:"1rem",background:"#fee2e2",borderRadius:"8px"},children:n}),!t&&!n&&d.length===0&&e.jsx("div",{className:"hint",style:{textAlign:"center",padding:"2rem",color:"var(--text-muted)"},children:"No hay historial disponible"}),d.map((c,g)=>{const m=parseFloat(c.insulin)||0,p=parseFloat(c.carbs)||0,o=m>0,h=o?"ðŸ’‰":"ðŸª",y=new Date(c.created_at||c.timestamp||c.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let x="";return m>0&&(x+=`${m} U `),p>0&&(x+=`${p} g`),e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"act-icon",style:o?{}:{background:"#fff7ed",color:"#f97316"},children:h}),e.jsxs("div",{className:"act-details",children:[e.jsx("div",{className:"act-val",children:x}),e.jsx("div",{className:"act-sub",children:c.notes||c.enteredBy||"Entrada"})]}),e.jsx("div",{className:"act-time",children:y})]},c._id||g)})]})]}),e.jsx(M,{activeTab:"history"})]})}function Je(){const[t,a]=r.useState("ns");return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Ajustes",showBack:!0}),e.jsxs("main",{className:"page",style:{paddingBottom:"80px"},children:[e.jsxs(T,{children:[e.jsxs("div",{className:"tabs",style:{display:"flex",borderBottom:"1px solid #e2e8f0",marginBottom:"1rem"},children:[e.jsx(Q,{label:"Nightscout",active:t==="ns",onClick:()=>a("ns")}),e.jsx(Q,{label:"CÃ¡lculo",active:t==="calc",onClick:()=>a("calc")}),e.jsx(Q,{label:"Datos",active:t==="data",onClick:()=>a("data")})]}),e.jsx("div",{style:{display:t==="ns"?"block":"none"},children:e.jsx(Ke,{})}),e.jsx("div",{style:{display:t==="calc"?"block":"none"},children:e.jsx(Ye,{})}),e.jsx("div",{style:{display:t==="data"?"block":"none"},children:e.jsx(Xe,{})})]}),t==="data"&&e.jsx(T,{title:"Estado del Backend",className:"mt-4",children:e.jsx(Qe,{})})]}),e.jsx(M,{activeTab:"settings"})]})}function Q({label:t,active:a,onClick:n}){return e.jsx("button",{onClick:n,style:{flex:1,padding:"0.75rem",background:"none",border:"none",borderBottom:a?"2px solid var(--primary)":"2px solid transparent",fontWeight:a?700:400,color:a?"var(--primary)":"var(--text-muted)",cursor:"pointer"},children:t})}function Ke(){const[t,a]=r.useState(""),[n,i]=r.useState(""),[d,u]=r.useState(!1),[s,l]=r.useState({msg:"",type:"neutral"}),[c,g]=r.useState(!1);r.useEffect(()=>{oe().then(o=>{o.url&&a(o.url),u(o.has_secret)}).catch(o=>console.warn(o))},[]);const m=async()=>{l({msg:"Probando...",type:"neutral"});try{let o;if(!n&&d){const{getNightscoutStatus:h}=await V(async()=>{const{getNightscoutStatus:S}=await import("./index-CjLpWvmv.js").then(y=>y.a1);return{getNightscoutStatus:S}},__vite__mapDeps([0,1]));o=await h(),o={ok:o.ok,message:o.error||"Conectado (Server)"}}else o=await ye({url:t,token:n});l({msg:o.ok?"âœ… Conectado Correctamente":`âŒ Error: ${o.message}`,type:o.ok?"success":"error"})}catch(o){l({msg:`âŒ Error: ${o.message}`,type:"error"})}},p=async()=>{if(!t)return alert("URL requerida");if(!n&&d){if(!window.confirm(`No has escrito el Token. Â¿Guardar SIN cambiar el secreto? 
(Si has cambiado la URL, debes reescribir el secreto).`))return;alert("Por seguridad, re-introduce el API Secret.");return}g(!0),l({msg:"Guardando...",type:"neutral"});try{await ce({url:t,api_secret:n,enabled:!0}),l({msg:"âœ… Guardado seguro.",type:"success"}),i(""),u(!0)}catch(o){l({msg:`âŒ Error guardando: ${o.message}`,type:"error"})}finally{g(!1)}};return e.jsxs("div",{className:"stack",children:[e.jsx("h3",{style:{marginTop:0},children:"ConexiÃ³n Nightscout"}),e.jsx("p",{className:"text-muted text-sm",children:"Tus credenciales se guardan encriptadas en la base de datos."}),e.jsx(B,{label:"URL Nightscout",value:t,onChange:o=>a(o.target.value),placeholder:"https://mi-nightscout.herokuapp.com"}),e.jsx(B,{label:"API Secret / Token",type:"password",value:n,onChange:o=>i(o.target.value),placeholder:d?"Configurado (Oculto) - Escribe para cambiar":"API Secret"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx(v,{variant:"secondary",onClick:m,children:"Probar"}),e.jsx(v,{onClick:p,disabled:c,children:c?"Guardando...":"Guardar"})]}),s.msg&&e.jsx("div",{style:{padding:"0.8rem",borderRadius:"8px",marginTop:"1rem",background:s.type==="error"?"#fee2e2":s.type==="success"?"#dcfce7":"#f1f5f9",color:s.type==="error"?"#ef4444":s.type==="success"?"#166534":"#334155",fontWeight:600},children:s.msg})]})}function Ye(){const t={breakfast:{icr:10,isf:50,target:110},lunch:{icr:10,isf:50,target:110},dinner:{icr:10,isf:50,target:110},snack:{icr:10,isf:50,target:110},dia_hours:4,round_step_u:.5,max_bolus_u:10,techne:{enabled:!1,max_step_change:.5,safety_iob_threshold:1.5}},[a,n]=r.useState(t),[i,d]=r.useState(de()),[u,s]=r.useState("breakfast"),[l,c]=r.useState(null);r.useEffect(()=>{const h=K();if(h){const S={...t,...h,techne:{...t.techne,...h.techne||{}}};n(S)}else ee(t)},[]);const g=(h,S,y=!1)=>{n(y?x=>({...x,[u]:{...x[u],[h]:parseFloat(S)}}):x=>({...x,[h]:parseFloat(S)}))},m=()=>{ee(a),c("ParÃ¡metros guardados correctamente."),setTimeout(()=>c(null),3e3)},p=()=>{be(i),alert("ConfiguraciÃ³n de bolo dividido guardada.")},o=a[u]||t[u];return e.jsxs("div",{className:"stack",children:[e.jsx("h3",{style:{marginTop:0},children:"ParÃ¡metros ClÃ­nicos"}),e.jsx("p",{className:"text-muted text-sm warning-text",children:"Ajusta con ayuda mÃ©dica profesional."}),e.jsx("div",{className:"sub-tabs",style:{display:"flex",gap:"0.2rem",background:"#f1f5f9",padding:"0.2rem",borderRadius:"8px",marginBottom:"1rem"},children:["breakfast","lunch","dinner","snack"].map(h=>e.jsx("button",{onClick:()=>s(h),style:{flex:1,padding:"0.4rem",border:"none",background:u===h?"white":"transparent",boxShadow:u===h?"0 1px 2px rgba(0,0,0,0.1)":"none",borderRadius:"6px",fontWeight:u===h?600:400,cursor:"pointer",textTransform:"capitalize"},children:h==="breakfast"?"Desay.":h==="lunch"?"Comida":h==="dinner"?"Cena":"Snack"},h))}),e.jsxs("div",{className:"stack",children:[e.jsx(B,{label:"Ratio (ICR - g/U)",type:"number",value:o.icr,onChange:h=>g("icr",h.target.value,!0)}),e.jsx(B,{label:"Sensibilidad (ISF - mg/dL/U)",type:"number",value:o.isf,onChange:h=>g("isf",h.target.value,!0)}),e.jsx(B,{label:"Objetivo (Target - mg/dL)",type:"number",value:o.target,onChange:h=>g("target",h.target.value,!0)})]}),e.jsx("hr",{style:{margin:"1rem 0",borderColor:"#f1f5f9"}}),e.jsxs("div",{className:"stack",children:[e.jsx(B,{label:"DuraciÃ³n Insulina (DIA - Horas)",type:"number",value:a.dia_hours,onChange:h=>g("dia_hours",h.target.value)}),e.jsx(B,{label:"MÃ¡ximo Bolo (Seguridad - U)",type:"number",value:a.max_bolus_u,onChange:h=>g("max_bolus_u",h.target.value)}),e.jsx("label",{style:{fontWeight:600,fontSize:"0.9rem",color:"#475569"},children:"Paso de redondeo"}),e.jsxs("select",{style:{width:"100%",padding:"0.6rem",borderRadius:"8px",border:"1px solid #cbd5e1"},value:a.round_step_u,onChange:h=>g("round_step_u",h.target.value),children:[e.jsx("option",{value:"0.5",children:"0.5 U"}),e.jsx("option",{value:"1.0",children:"1.0 U"}),e.jsx("option",{value:"0.1",children:"0.1 U"}),e.jsx("option",{value:"0.05",children:"0.05 U"})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.8rem",fontWeight:600,marginBottom:a.techne?.enabled?"1rem":0,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:a.techne?.enabled,onChange:h=>n(S=>({...S,techne:{...S.techne,enabled:h.target.checked}})),style:{width:"1.2rem",height:"1.2rem"}}),"Redondeo Inteligente (Techne)"]}),a.techne?.enabled&&e.jsxs("div",{className:"stack",style:{gap:"0.8rem",marginTop:"0.5rem"},children:[e.jsx("p",{className:"text-sm text-muted",style:{margin:0},children:"Usa la flecha de tendencia para decidir si redondear hacia arriba (â†—) o abajo (â†˜)."}),e.jsx(B,{label:"LÃ­mite cambio mÃ¡x (Seguridad - U)",type:"number",value:a.techne.max_step_change,onChange:h=>n(S=>({...S,techne:{...S.techne,max_step_change:parseFloat(h.target.value)}}))}),e.jsx(B,{label:"Desactivar si IOB mayor que (U)",type:"number",value:a.techne.safety_iob_threshold,onChange:h=>n(S=>({...S,techne:{...S.techne,safety_iob_threshold:parseFloat(h.target.value)}}))})]})]})]}),e.jsx(v,{onClick:m,style:{marginTop:"1rem"},children:"Guardar ParÃ¡metros"}),l&&e.jsx("div",{className:"text-teal text-center text-sm",style:{marginTop:"0.5rem"},children:l}),e.jsxs("details",{style:{marginTop:"2rem",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"0.5rem"},children:[e.jsx("summary",{style:{fontWeight:600,cursor:"pointer",padding:"0.5rem"},children:"Avanzado: Bolo Dividido"}),e.jsxs("div",{className:"stack",style:{padding:"1rem"},children:[e.jsxs("label",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:i.enabled_default,onChange:h=>d({...i,enabled_default:h.target.checked})}),"Activar por defecto"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem"},children:[e.jsx(B,{label:"% Ahora",type:"number",value:i.percent_now,onChange:h=>d({...i,percent_now:parseInt(h.target.value)})}),e.jsx(B,{label:"DuraciÃ³n (min)",type:"number",value:i.duration_min,onChange:h=>d({...i,duration_min:parseInt(h.target.value)})})]}),e.jsx(B,{label:"Recordar 2Âª parte tras (min)",type:"number",value:i.later_after_min,onChange:h=>d({...i,later_after_min:parseInt(h.target.value)})}),e.jsx(v,{variant:"secondary",onClick:p,children:"Guardar Avanzado"})]})]})]})}function Xe(){const t=async()=>{try{const a=await je(),n=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),i=URL.createObjectURL(n),d=document.createElement("a");d.href=i,d.download=`bolus_ai_export_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(i)}catch(a){alert(a.message)}};return e.jsxs("div",{className:"stack",children:[e.jsxs("div",{style:{background:"#f8fafc",padding:"1rem",borderRadius:"8px"},children:[e.jsx("h3",{style:{fontSize:"1.1rem",margin:"0 0 0.5rem 0"},children:"Exportar Historial"}),e.jsx("p",{style:{marginBottom:"1rem",color:"#64748b",fontSize:"0.9rem"},children:"Descarga copia de seguridad de todos tus datos."}),e.jsx(v,{variant:"secondary",onClick:t,children:"ðŸ“¥ Descargar Todo (JSON)"})]}),e.jsxs("div",{style:{background:"#f8fafc",padding:"1rem",borderRadius:"8px"},children:[e.jsx("h3",{style:{fontSize:"1.1rem",margin:"0 0 0.5rem 0"},children:"Notificaciones Push"}),e.jsx("p",{style:{marginBottom:"1rem",color:"#64748b",fontSize:"0.9rem"},children:"Recibe alertas de anÃ¡lisis."}),e.jsx(v,{variant:"ghost",onClick:()=>alert("PrÃ³ximamente"),children:"ðŸ”” Activar"})]})]})}function Qe(){const[t,a]=r.useState("Sin comprobar"),n=async()=>{a("Consultando...");try{const i=await ve();a(JSON.stringify(i,null,2))}catch(i){a("Error: "+i.message)}};return e.jsxs("div",{children:[e.jsx(v,{variant:"ghost",onClick:n,style:{marginBottom:"0.5rem"},children:"Comprobar ConexiÃ³n"}),e.jsx("pre",{style:{background:"#0f172a",color:"#22d3ee",padding:"0.5rem",borderRadius:"6px",overflowX:"auto",fontSize:"0.75rem"},children:t})]})}function ne(t,a){const n=r.useRef();r.useEffect(()=>{n.current=t},[t]),r.useEffect(()=>{function i(){n.current()}if(a!==null){let d=setInterval(i,a);return()=>clearInterval(d)}},[a])}function Ze(t,a){return{DoubleUp:"â†‘â†‘",SingleUp:"â†‘",FortyFiveUp:"â†—",Flat:"â†’",FortyFiveDown:"â†˜",SingleDown:"â†“",DoubleDown:"â†“â†“"}[t]||t||""}function et({onRefresh:t}){const[a,n]=r.useState(null),[i,d]=r.useState(!1);ne(()=>u(),6e4);const u=async()=>{d(!0);try{const m=W(),p=await ue(m);n(p)}catch(m){console.warn("BG Fetch Error",m)}finally{d(!1)}};r.useEffect(()=>{u()},[t]);const s=a?Math.round(a.bg_mgdl):"--",l=a?a.trendArrow||Ze(a.trend):"--",c=a?`${Math.round(a.age_minutes)} min`:"--",g=a?a.bg_mgdl>180||a.bg_mgdl<=70?"#ef4444":"#10b981":"#64748b";return e.jsxs("section",{className:"card glucose-hero",style:{marginBottom:"1rem",padding:"1.5rem",borderRadius:"16px",background:"#fff",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsxs("div",{className:"gh-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,color:"#64748b",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Glucosa Actual"}),e.jsx("button",{onClick:u,style:{background:"none",border:"none",fontSize:"1.2rem",cursor:"pointer",color:i?"#cbd5e1":"#3b82f6"},children:i?"...":"â†»"})]}),a&&a.is_compression&&e.jsxs("div",{style:{background:"#fef2f2",color:"#991b1b",fontSize:"0.8rem",padding:"0.4rem",borderRadius:"6px",marginBottom:"0.5rem",border:"1px solid #fca5a5",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx("span",{children:"âš ï¸"}),e.jsx("span",{title:a.compression_reason,children:"Posible falsa bajada (CompresiÃ³n)"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"3.5rem",fontWeight:800,color:g,lineHeight:1,textDecoration:a?.is_compression?"underline 3px dotted #fca5a5":"none"},children:s}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx("span",{style:{fontSize:"1.5rem",color:g,fontWeight:800},children:l}),e.jsx("span",{style:{fontSize:"0.8rem",color:"#94a3b8",fontWeight:600},children:"mg/dL"})]})]}),e.jsx("div",{style:{textAlign:"center",marginTop:"0.5rem"},children:e.jsxs("span",{style:{background:"#f1f5f9",color:"#64748b",fontSize:"0.75rem",padding:"4px 8px",borderRadius:"12px",fontWeight:600},children:["Hace ",c]})})]})}function tt({onRefresh:t}){const[a,n]=r.useState({val:null,status:"ok",cob:null}),[i,d]=r.useState(null);ne(()=>u(),6e4);const u=async()=>{try{const s=W(),l=await me(s),c=l.iob_u??l.iob_total??0,g=l.cob_total??0,m=l.iob_info?.status||"ok";n({val:c,status:m,cob:g});const o=(await re({...s,count:20})).find(h=>parseFloat(h.insulin)>0&&h.eventType!=="Temp Basal");d(o?parseFloat(o.insulin):null)}catch(s){console.warn("Metrics Error",s)}};return r.useEffect(()=>{u()},[t]),e.jsxs("div",{className:"metrics-grid",style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.75rem",marginBottom:"1.5rem"},children:[e.jsx(Z,{icon:"ðŸ’§",label:"IOB",value:a.val!==null?a.val.toFixed(2):"--",unit:"U",highlight:a.val>0}),e.jsx(Z,{icon:"ðŸª",label:"COB",value:a.cob!==null?Math.round(a.cob):"--",unit:"g",highlight:a.cob>0}),e.jsx(Z,{icon:"ðŸ’‰",label:"Ãšltimo",value:i!==null?i:"--",unit:"U"})]})}function Z({icon:t,label:a,value:n,unit:i,highlight:d}){return e.jsxs("div",{style:{background:d?"#eff6ff":"#fff",borderRadius:"12px",padding:"1rem 0.5rem",textAlign:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.05)",border:d?"1px solid #bfdbfe":"1px solid #f1f5f9"},children:[e.jsxs("div",{style:{fontSize:"0.8rem",fontWeight:600,color:"#64748b",marginBottom:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[e.jsx("span",{children:t})," ",a]}),e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:800,color:d?"#2563eb":"#334155"},children:[n," ",e.jsx("span",{style:{fontSize:"0.7rem",color:"#94a3b8",fontWeight:600},children:i})]})]})}function at(){return e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{className:"section-title",style:{marginBottom:"1rem",marginTop:0,fontSize:"1.1rem",color:"#1e293b"},children:"Acciones RÃ¡pidas"}),e.jsxs("div",{className:"qa-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"0.5rem"},children:[e.jsx(J,{icon:"â­",label:"Favoritos",onClick:()=>D("#/favorites"),color:"#f59e0b",bg:"#fffbeb"}),e.jsx(J,{icon:"ðŸ§®",label:"Calcular",onClick:()=>D("#/bolus"),color:"#3b82f6",bg:"#eff6ff"}),e.jsx(J,{icon:"âš–ï¸",label:"BÃ¡scula",onClick:()=>D("#/scan"),color:"#10b981",bg:"#ecfdf5"}),e.jsx(J,{icon:"ðŸ´",label:"Alimentos",onClick:()=>D("#/bolus"),color:"#f97316",bg:"#fff7ed"})]})]})}function J({icon:t,label:a,onClick:n,color:i,bg:d}){return e.jsxs("button",{className:"qa-btn",onClick:n,style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#fff",border:"none",borderRadius:"12px",padding:"0.8rem 0.2rem",gap:"0.5rem",cursor:"pointer",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",transition:"transform 0.1s"},children:[e.jsx("div",{style:{fontSize:"1.4rem",background:d,width:"42px",height:"42px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:i},children:t}),e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"#475569"},children:a})]})}function st({onRefresh:t}){const[a,n]=r.useState([]),[i,d]=r.useState(!1),u=async()=>{d(!0);try{const s=W(),[l,c]=await Promise.all([re({...s,count:20}),V(()=>import("./index-CjLpWvmv.js").then(p=>p.a1),__vite__mapDeps([0,1])).then(p=>p.getLatestBasal()).catch(()=>null)]);let g=l.map(p=>({...p,dateObj:new Date(p.created_at||p.timestamp||p.date),type:"treatment"}));if(c&&c.dose_u>0&&c.created_at){const p=new Date(c.created_at);(new Date-p)/(1e3*60*60)<48&&g.push({insulin:c.dose_u,carbs:0,created_at:c.created_at,dateObj:p,notes:"Basal Manual",enteredBy:"BolusAI",type:"basal"})}g.sort((p,o)=>o.dateObj-p.dateObj);const m=g.filter(p=>parseFloat(p.insulin)>0||parseFloat(p.carbs)>0).slice(0,3);n(m)}catch(s){console.warn(s)}finally{d(!1)}};return r.useEffect(()=>{u()},[t]),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#1e293b"},children:"Actividad Reciente"}),e.jsx("span",{onClick:()=>D("#/history"),style:{fontSize:"0.85rem",color:"#3b82f6",fontWeight:600,cursor:"pointer"},children:"Ver todo"})]}),e.jsxs("div",{className:"activity-list",style:{display:"flex",flexDirection:"column",gap:"0.5rem",minHeight:"60px"},children:[i&&e.jsx("div",{className:"spinner small"}),!i&&a.length===0&&e.jsx("div",{className:"text-muted text-center",style:{fontSize:"0.85rem"},children:"Sin actividad reciente"}),a.map((s,l)=>{const c=parseFloat(s.insulin)||0,g=parseFloat(s.carbs)||0,m=c>0,p=new Date(s.created_at||s.timestamp||s.date);return e.jsxs("div",{className:"activity-item",style:{display:"flex",alignItems:"center",gap:"0.75rem",background:"#fff",padding:"0.75rem",borderRadius:"12px",border:"1px solid #f8fafc"},children:[e.jsx("div",{style:{fontSize:"1.2rem",background:m?"#eff6ff":"#fff7ed",width:"36px",height:"36px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:m?"ðŸ’‰":"ðŸª"}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:"0.9rem",color:"#334155"},children:[c>0&&`${c} U `," ",g>0&&`${g} g`]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#94a3b8"},children:s.notes||s.enteredBy||"Entrada"})]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#cbd5e1",fontWeight:500},children:p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},l)})]})]})}function rt(){const[t,a]=r.useState(null),[n,i]=r.useState(null),[d,u]=r.useState(null),[s,l]=r.useState(!1),[c,g]=r.useState(null),[m,p]=r.useState(0);if(ne(()=>{const x=Se();x?(a(x),i(Ce(x))):a(null)},5e3),!t)return null;const o=()=>{confirm("Â¿Borrar plan activo?")&&(localStorage.removeItem("bolusai_active_dual_plan"),a(null))},h=async()=>{l(!0),g(null),u(null);try{const{recalcSecondBolus:x,getLocalNsConfig:w}=await V(async()=>{const{recalcSecondBolus:z,getLocalNsConfig:O}=await import("./index-CjLpWvmv.js").then(H=>H.a1);return{recalcSecondBolus:z,getLocalNsConfig:O}},__vite__mapDeps([0,1])),{getCalcParams:b,getDefaultMealParams:k}=await V(async()=>{const{getCalcParams:z,getDefaultMealParams:O}=await import("./index-CjLpWvmv.js").then(H=>H.a2);return{getCalcParams:z,getDefaultMealParams:O}},__vite__mapDeps([0,1])),C=w();if(!C?.url)throw new Error("Configura Nightscout");const R=b(),_=t.slot||"lunch",P=R?R[_]||k(R):null;if(!P)throw new Error("Faltan parÃ¡metros de cÃ¡lculo");const N={later_u_planned:t.later_u_planned,carbs_additional_g:parseFloat(m)||0,params:{cr_g_per_u:P.icr,isf_mgdl_per_u:P.isf,target_bg_mgdl:P.target,round_step_u:R.round_step_u||.05,max_bolus_u:R.max_bolus_u||10,stale_bg_minutes:15},nightscout:{url:C.url,token:C.token,units:"mgdl"}},A=await x(N);u(A)}catch(x){g(x.message)}finally{l(!1)}},S=n?.remaining_min??"--",y=n?.elapsed_min??"--";return e.jsxs("section",{className:"card u2-card",style:{marginBottom:"1rem",background:"#f0f9ff",borderColor:"#bae6fd"},children:[e.jsxs("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,color:"#0369a1",fontSize:"1rem"},children:"â±ï¸ Bolo Dividido (U2)"}),e.jsx("button",{onClick:o,style:{background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"0.8rem"},children:"Ocultar"})]}),e.jsxs("div",{className:"stack",style:{marginTop:"0.5rem"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"2rem",fontWeight:800,color:"#0ea5e9"},children:[S," min"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:"para la segunda dosis"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",background:"#fff",padding:"0.5rem",borderRadius:"8px"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:"Planificado"}),e.jsxs("strong",{style:{color:"#0284c7"},children:[t.later_u_planned," U"]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.7rem",color:"#94a3b8"},children:"Transcurrido"}),e.jsxs("strong",{children:[y," min"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"0.75rem",fontWeight:600,color:"#475569"},children:"Carbs Extra (g)"}),e.jsx("input",{type:"number",style:{width:"100%",padding:"0.4rem",borderRadius:"4px",border:"1px solid #cbd5e1"},value:m,onChange:x=>p(x.target.value)})]}),e.jsx(v,{onClick:h,style:{marginTop:"1.2rem"},disabled:s,children:s?"...":"Recalcular"})]}),c&&e.jsx("div",{className:"text-danger text-sm",children:c}),d&&e.jsxs("div",{style:{background:"#f0fdf4",border:"1px solid #bbf7d0",padding:"0.8rem",borderRadius:"8px",marginTop:"0.5rem"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:800,textAlign:"center",color:"#16a34a",marginBottom:"0.5rem"},children:[d.u2_recommended_u," U"]}),e.jsxs("div",{className:"text-sm",children:["BG: ",Math.round(d.bg_now_mgdl)," | IOB: ",d.iob_now_u?.toFixed(2)]}),d.warnings?.map((x,w)=>e.jsxs("div",{className:"text-xs text-orange-600",children:["âš ï¸ ",x]},w))]})]})]})}function nt(){const[t,a]=r.useState(0);return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Bolus AI",showBack:!1}),e.jsxs("main",{className:"page",style:{paddingBottom:"90px"},children:[e.jsx(et,{onRefresh:t}),e.jsx(rt,{})," ",e.jsx(tt,{onRefresh:t}),e.jsx(at,{}),e.jsx(st,{onRefresh:t})]}),e.jsx(M,{activeTab:"home"})]})}function lt(){const[t,a]=r.useState(""),[n,i]=r.useState(""),[d,u]=r.useState(()=>{const j=new Date;return new Date(j.getTime()-j.getTimezoneOffset()*6e4).toISOString().slice(0,16)}),[s,l]=r.useState("lunch"),[c,g]=r.useState(!1),[m,p]=r.useState(!1),[o,h]=r.useState(null),[S,y]=r.useState(!1),[x,w]=r.useState(!1),[b,k]=r.useState(!1),[C,R]=r.useState(null),[_]=r.useState(W()||{}),P=ge.useRef(null),[N,A]=r.useState(null);r.useEffect(()=>{f.tempCarbs&&(i(String(f.tempCarbs)),f.tempCarbs=null),f.tempLearningHint&&(A(f.tempLearningHint),f.tempLearningHint.suggest_extended&&p(!0),f.tempLearningHint=null),(f.tempItems||f.tempFat||f.tempProtein)&&(P.current={items:f.tempItems||[],fat:f.tempFat||0,protein:f.tempProtein||0}),(f.tempFat>15||f.tempProtein>20)&&p(!0),f.tempFat=null,f.tempProtein=null,f.tempItems=null,z()},[]);const z=async()=>{try{const j=await ue(_);j&&j.bg_mgdl&&a(String(Math.round(j.bg_mgdl)));const I=await me(_);if(I){const F=I.iob_u??I.iob_total??0;R(F)}}catch(j){console.warn(j)}},O=()=>p(!m),H=async()=>{w(!0),h(null);try{const j=t===""?NaN:parseFloat(t),I=parseFloat(n)||0;if(c&&isNaN(j))throw new Error("Para correcciÃ³n se requiere glucosa.");const F=K();if(!F)throw new Error("No hay configuraciÃ³n de ratios.");const E=F[s];if(!E?.icr||!E?.isf||!E?.target)throw new Error(`Faltan datos para el horario '${s}'.`);const G={carbs_g:c?0:I,bg_mgdl:isNaN(j)?null:j,meal_slot:s,target_mgdl:E.target,cr_g_per_u:E.icr,isf_mgdl_per_u:E.isf,dia_hours:F.dia_hours||4,round_step_u:F.round_step_u||.5,max_bolus_u:F.max_bolus_u||15};let U=de()||{};m?U.enabled=!0:U.enabled=!1;const $=m&&!c&&I>0,X=await we(G,$?U:null);h(X)}catch(j){alert("Error: "+j.message)}finally{w(!1)}},fe=async j=>{k(!0);try{const I=parseFloat(j);if(isNaN(I)||I<0)throw new Error("Dosis invÃ¡lida");const E={eventType:"Meal Bolus",created_at:new Date(d).toISOString(),carbs:parseFloat(n)||0,insulin:I,enteredBy:f.user?.username||"BolusAI",notes:`BolusAI: ${o.kind==="dual"?"Dual":"Normal"}. Gr: ${n}. BG: ${t}`,nightscout:{url:_.url||null}};if(P.current){const $=o.kind==="dual"?{kind:"dual",total:o.total_u_final,upfront:o.upfront_u,later:o.later_u,delay:o.duration_min}:{kind:"normal",total:o.total_u_final};E.meal_meta={...P.current,strategy:$}}o.kind==="dual"&&(E.notes+=` (Split: ${o.upfront_u} now + ${o.later_u} over ${o.duration_min}m)`,f.lastBolusPlan=o.plan,f.lastBolusPlan.now_u=I,V(async()=>{const{saveDualPlan:$}=await import("./index-CjLpWvmv.js").then(X=>X.a2);return{saveDualPlan:$}},__vite__mapDeps([0,1])).then(({saveDualPlan:$})=>$(o.plan)));const G=await ke(E);let U="Bolo registrado con Ã©xito (Local).";G&&G.nightscout&&(G.nightscout.uploaded?U="âœ… Bolo guardado (Local + Nightscout).":U=`âš ï¸ Guardado SOLO local.
Error Nightscout: `+(G.nightscout.error||"Desconocido")),alert(U),D("#/")}catch(I){alert("Error guardando: "+I.message)}finally{k(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Calcular Bolo",showBack:!0}),e.jsxs("main",{className:"page",style:{paddingBottom:"90px"},children:[!o&&e.jsxs("div",{className:"stack fade-in",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("div",{className:"label-row",style:{display:"flex",justifyContent:"space-between"},children:e.jsx("span",{className:"label-text",children:"ðŸ’§ Glucosa Actual"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"number",value:t,onChange:j=>a(j.target.value),placeholder:"mg/dL",className:"text-center big-input",style:{width:"100%",fontSize:"1.5rem",fontWeight:800,color:"var(--primary)",padding:"0.5rem",borderRadius:"8px",border:"1px solid #cbd5e1"}}),e.jsx("span",{style:{position:"absolute",right:"1rem",top:"1rem",color:"var(--text-muted)"},children:"mg/dL"})]}),t&&!isNaN(parseFloat(t))&&e.jsx("input",{type:"range",min:"40",max:"400",value:t,onChange:j=>a(j.target.value),className:"w-full mt-2"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{style:{fontSize:"0.85rem",color:"#64748b"},children:"Fecha / Hora"}),e.jsx("input",{type:"datetime-local",value:d,onChange:j=>u(j.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"8px",border:"1px solid #cbd5e1"}})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center",margin:"1rem 0"},children:[e.jsxs("select",{value:s,onChange:j=>l(j.target.value),style:{padding:"0.5rem",borderRadius:"8px",border:"1px solid #cbd5e1",background:"#fff"},children:[e.jsx("option",{value:"breakfast",children:"Desayuno"}),e.jsx("option",{value:"lunch",children:"Comida"}),e.jsx("option",{value:"dinner",children:"Cena"}),e.jsx("option",{value:"snack",children:"Snack"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem"},children:[e.jsx("input",{type:"checkbox",checked:c,onChange:j=>{g(j.target.checked),j.target.checked&&i("0")}}),"Solo CorrecciÃ³n"]})]}),e.jsxs("div",{className:`form-group ${c?"opacity-50 pointer-events-none":""}`,children:[e.jsx("div",{className:"label-row",children:e.jsx("span",{className:"label-text",children:"ðŸª Carbohidratos"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"number",value:n,onChange:j=>i(j.target.value),placeholder:"0",className:"text-center big-input",style:{width:"100%",fontSize:"1.5rem",fontWeight:800,color:"var(--text)",padding:"0.5rem",borderRadius:"8px",border:"1px solid #cbd5e1"}}),e.jsx("span",{style:{position:"absolute",right:"1rem",top:"1rem",color:"var(--text-muted)"},children:"g"})]}),e.jsx("div",{className:"carb-presets",style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",flexWrap:"wrap",justifyContent:"center"},children:[0,15,30,45,60].map(j=>e.jsxs("button",{onClick:()=>i(String(j)),style:{padding:"0.3rem 0.8rem",borderRadius:"16px",border:"1px solid #cbd5e1",background:parseFloat(n)===j?"var(--primary)":"#fff",color:parseFloat(n)===j?"#fff":"#334155"},children:[j,"g"]},j))})]}),N&&e.jsxs("div",{className:"fade-in",style:{background:N.suggest_extended&&!m?"#fff7ed":N.suggest_extended?"#f0fdf4":"#fff7ed",border:`1px solid ${N.suggest_extended&&!m?"#fdba74":N.suggest_extended?"#86efac":"#fdba74"}`,borderRadius:"12px",padding:"0.8rem",marginBottom:"0.5rem",fontSize:"0.85rem",color:"#334155",transition:"all 0.3s ease"},children:[e.jsxs("div",{style:{fontWeight:600,color:N.suggest_extended&&!m?"#c2410c":N.suggest_extended?"#15803d":"#c2410c",display:"flex",alignItems:"center",gap:"5px",justifyContent:"space-between"},children:[e.jsx("span",{style:{display:"flex",alignItems:"center",gap:"5px"},children:"ðŸ§  Memoria de Efectos"}),N.suggest_extended&&e.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"12px",background:"rgba(0,0,0,0.05)"},children:m?"Aplicada":"Ignorada"})]}),e.jsx("div",{style:{marginTop:"4px"},children:N.reason}),N.evidence&&e.jsxs("div",{style:{fontSize:"0.75rem",marginTop:"4px",opacity:.8},children:["Basado en ",N.evidence.n," comidas similares."]})]}),e.jsxs("div",{className:"card",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem",border:"1px solid #e2e8f0"},children:[e.jsx("div",{style:{fontWeight:600},children:"ðŸŒŠ Bolo Dual / Extendido"}),e.jsx("input",{type:"checkbox",checked:m,onChange:O,style:{transform:"scale(1.5)"}})]}),e.jsxs("div",{style:{background:"#eff6ff",padding:"1rem",borderRadius:"12px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"#1e40af"},children:"Insulina Activa (IOB)"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#60a5fa"},children:"Se restarÃ¡ del bolo"})]}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"#1e40af"},children:[C!==null?C.toFixed(2):"--"," ",e.jsx("span",{style:{fontSize:"1rem"},children:"U"})]})]}),e.jsx(v,{onClick:H,disabled:x,className:"btn-primary",style:{width:"100%",padding:"1rem",fontSize:"1.1rem"},children:x?"Calculando...":"Calcular Bolo"})]}),o&&e.jsx(it,{result:o,onBack:()=>h(null),onSave:fe,saving:b})]}),e.jsx(M,{activeTab:"bolus"})]})}function it({result:t,onBack:a,onSave:n,saving:i}){const[d,u]=r.useState(t.upfront_u);return e.jsxs("div",{className:"card result-card fade-in",style:{border:"2px solid var(--primary)",padding:"1.5rem"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{className:"text-muted",children:"Bolo Recomendado"}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"baseline",gap:"5px"},children:[e.jsx("input",{type:"number",value:d,onChange:s=>u(s.target.value),step:"0.5",style:{width:"140px",textAlign:"right",fontSize:"3rem",color:"var(--primary)",fontWeight:800,border:"none",borderBottom:"2px dashed var(--primary)",outline:"none",background:"transparent"}}),e.jsx("span",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--primary)"},children:"U"})]}),t.kind==="dual"&&e.jsxs("div",{className:"text-muted",style:{marginTop:"0.5rem"},children:["+ ",t.later_u," U extendido (",t.duration_min," min)"]})]}),e.jsx("ul",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#64748b",paddingLeft:"1.2rem"},children:t.calc?.explain?.map((s,l)=>e.jsx("li",{children:s},l))}),t.warnings&&t.warnings.length>0&&e.jsxs("div",{style:{background:"#fff7ed",color:"#c2410c",padding:"0.8rem",margin:"1rem 0",borderRadius:"8px",fontSize:"0.85rem",border:"1px solid #fed7aa"},children:[e.jsx("strong",{children:"âš ï¸ AtenciÃ³n:"}),t.warnings.map((s,l)=>e.jsxs("div",{children:["â€¢ ",s]},l))]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1.5rem"},children:[e.jsx(v,{onClick:()=>n(d),disabled:i,style:{flex:1,background:"var(--success)"},children:i?"Guardando...":"âœ… Confirmar"}),e.jsx(v,{variant:"ghost",onClick:a,disabled:i,style:{flex:1},children:"Cancelar"})]})]})}function ot(){const[t,a]=r.useState(f.plateBuilder?.entries||[]),[n,i]=r.useState(f.scale||{connected:!1,grams:0,stable:!0});r.useEffect(()=>{const u=s=>{typeof s.grams=="number"&&(f.scale.grams=s.grams),typeof s.stable=="boolean"&&(f.scale.stable=s.stable),typeof s.connected=="boolean"&&(f.scale.connected=s.connected),i({...f.scale})};return f.scale.connected&&te(u),window.scaleHandler=u,()=>{te(null)}},[]);const d=u=>{a([...u]),f.plateBuilder.entries=u,f.plateBuilder.total=u.reduce((s,l)=>s+l.carbs,0)};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Escanear / Pesar",showBack:!0}),e.jsxs("main",{className:"page",style:{paddingBottom:"90px"},children:[e.jsx(ct,{scaleGrams:n.grams,plateEntries:t,onAddEntry:u=>d([...t,u])}),e.jsx(dt,{scale:n,setScale:i}),e.jsx(ut,{entries:t,onUpdate:d,scaleGrams:n.grams})]}),e.jsx(M,{activeTab:"scan"})]})}function ct({scaleGrams:t,plateEntries:a,onAddEntry:n}){const[i,d]=r.useState(!1),[u,s]=r.useState(null),[l,c]=r.useState(null),g=r.useRef(null),m=r.useRef(null),[p,o]=r.useState("plate"),[h,S]=r.useState([]),y=async w=>{const b=w.target.files?.[0];if(!b)return;const k=new FileReader;k.onload=C=>{s(C.target.result),f.currentImageBase64=C.target.result},k.readAsDataURL(b),d(!0),c(null),S([]);try{const C={};let R=0;if(p==="plate"&&t>0){const A=a.reduce((z,O)=>z+(O.weight||0),0);R=Math.max(0,t-A),C.plate_weight_grams=R}a.length>0&&(C.existing_items=a.map(A=>A.name).join(", ")),p==="menu"&&(C.portion_hint="restaurant menu, list individual dishes");const _=await _e(b,C),P=(_.items||[]).reduce((A,z)=>A+(z.fat_g||0),0),N=(_.items||[]).reduce((A,z)=>A+(z.protein_g||0),0);if(p==="plate"){const A={carbs:_.carbs_estimate_g,weight:R,fat:P,protein:N,img:f.currentImageBase64,name:_.food_name||"Alimento IA"};n(A),_.learning_hint&&(f.tempLearningHint=_.learning_hint);let z=`âœ… AÃ±adido: ${_.carbs_estimate_g}g`;(P>5||N>5)&&(z+=` (G:${Math.round(P)}, P:${Math.round(N)})`),_.bolus&&_.bolus.kind==="extended"?z+=" ðŸ’¡ Sugiere Dual":_.learning_hint&&_.learning_hint.suggest_extended&&(z+=" ðŸ§  Memoria Sugiere Dual"),c(z),setTimeout(()=>c(null),3e3)}else _.items&&_.items.length>0?(S(_.items),c("ðŸ‘‡ Selecciona los platos que vas a pedir")):c("âš ï¸ No se detectaron platos claros en la carta")}catch(C){c(`âŒ Error: ${C.message}`)}finally{d(!1)}},x=w=>{n({carbs:w.carbs_g,fat:w.fat_g||0,protein:w.protein_g||0,name:w.name,img:null}),c(`âœ… AÃ±adido: ${w.name}`),setTimeout(()=>c(null),2e3)};return e.jsxs("div",{className:"stack",children:[e.jsxs("div",{style:{display:"flex",background:"#e2e8f0",padding:"6px",borderRadius:"16px",marginBottom:"1.5rem",gap:"6px"},children:[e.jsxs("button",{onClick:()=>o("plate"),style:{flex:1,padding:"12px",borderRadius:"12px",border:"none",background:p==="plate"?"#fff":"transparent",color:p==="plate"?"var(--primary)":"#64748b",fontWeight:p==="plate"?800:500,boxShadow:p==="plate"?"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)":"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"1rem"},children:[e.jsx("span",{style:{fontSize:"1.4rem"},children:"ðŸ½ï¸"})," Un Plato"]}),e.jsxs("button",{onClick:()=>o("menu"),style:{flex:1,padding:"12px",borderRadius:"12px",border:"none",background:p==="menu"?"#fff":"transparent",color:p==="menu"?"var(--primary)":"#64748b",fontWeight:p==="menu"?800:500,boxShadow:p==="menu"?"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)":"none",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"1rem"},children:[e.jsx("span",{style:{fontSize:"1.4rem"},children:"ðŸ“œ"})," Carta"]})]}),e.jsxs("div",{className:"camera-placeholder",onClick:()=>g.current.click(),style:{background:"#f1f5f9",borderRadius:"16px",height:"200px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"2px dashed #cbd5e1",cursor:"pointer",overflow:"hidden",position:"relative"},children:[u?e.jsx("img",{src:u,style:{width:"100%",height:"100%",objectFit:"contain"}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:"3rem"},children:"ðŸ“·"}),e.jsx("div",{style:{color:"#64748b"},children:"Toca para tomar foto"})]}),i&&e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(255,255,255,0.8)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"var(--primary)"},children:"â³ Analizando IA..."})]}),l&&e.jsx("div",{style:{textAlign:"center",padding:"0.5rem",marginTop:"0.5rem",background:l.startsWith("âŒ")?"#fee2e2":"#dcfce7",color:l.startsWith("âŒ")?"#991b1b":"#166534",borderRadius:"8px"},children:l}),p==="menu"&&h.length>0&&e.jsxs("div",{className:"menu-results",style:{marginTop:"1rem",border:"1px solid #e2e8f0",borderRadius:"12px",overflow:"hidden"},children:[e.jsx("div",{style:{background:"#f8fafc",padding:"0.5rem 1rem",borderBottom:"1px solid #e2e8f0",fontWeight:600,color:"#475569"},children:"Platos Detectados"}),h.map((w,b)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1rem",borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:600},children:w.name}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:["~",w.carbs_g,"g carbs"]})]}),e.jsx(v,{size:"sm",onClick:()=>x(w),style:{padding:"0.4rem 0.8rem"},children:"+ AÃ±adir"})]},b))]}),e.jsxs("div",{className:"vision-actions",style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsx(v,{onClick:()=>g.current.click(),style:{flex:1},children:"ðŸ“· CÃ¡mara"}),e.jsx(v,{variant:"secondary",onClick:()=>m.current.click(),style:{flex:1},children:"ðŸ–¼ï¸ GalerÃ­a"})]}),e.jsx("input",{type:"file",ref:g,accept:"image/*",capture:"environment",hidden:!0,onChange:y}),e.jsx("input",{type:"file",ref:m,accept:"image/*",hidden:!0,onChange:y})]})}function dt({scale:t,setScale:a}){const n=async()=>{if(t.connected)await Ne(),a(u=>({...u,connected:!1})),f.scale.connected=!1;else try{await Be(),f.scale.connected=!0,a(u=>({...u,connected:!0})),window.scaleHandler&&te(window.scaleHandler)}catch(u){alert("Error conectando bÃ¡scula: "+u.message)}},i=async()=>{await ze()},d=()=>{f.tempCarbs=t.grams,D("#/bolus")};return e.jsxs(T,{className:"scale-card",style:{marginTop:"1.5rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"âš–ï¸ BÃ¡scula Bluetooth"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{className:`status-badge ${t.connected?"success":""}`,style:{padding:"0.25rem 0.75rem",borderRadius:"99px",fontSize:"0.75rem",fontWeight:600,background:t.connected?"#dcfce7":"#f1f5f9",color:t.connected?"#166534":"#64748b"},children:t.connected?"Conectado":"Desconectado"}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs("div",{style:{fontSize:"2rem",fontWeight:800,color:"var(--primary)"},children:[t.grams!==null?t.grams:"--"," ",e.jsx("span",{style:{fontSize:"1rem"},children:"g"})]})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsx(v,{variant:"secondary",onClick:n,style:{flex:1},children:t.connected?"Desconectar":"Conectar"}),e.jsx(v,{variant:"ghost",onClick:i,disabled:!t.connected,children:"Tarar"}),e.jsx(v,{onClick:d,disabled:!t.connected||!t.grams,children:"Usar Peso"})]})]})}function ut({entries:t,onUpdate:a,scaleGrams:n}){const i=t.reduce((s,l)=>s+l.carbs,0),d=s=>{const l=[...t];l.splice(s,1),a(l)},u=()=>{f.tempCarbs=i,f.tempFat=t.reduce((s,l)=>s+(l.fat||0),0),f.tempProtein=t.reduce((s,l)=>s+(l.protein||0),0),f.tempItems=t.map(s=>s.name),f.tempReason="plate_builder",D("#/bolus")};return e.jsxs(T,{style:{marginTop:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0},children:"ðŸ½ï¸ Mi Plato"}),e.jsxs("span",{style:{fontWeight:700,color:"var(--primary)"},children:[Math.round(i),"g  Total"]})]}),e.jsxs("div",{style:{minHeight:"50px",marginBottom:"1rem"},children:[t.length===0&&e.jsx("div",{className:"text-muted text-center",style:{padding:"1rem"},children:"Plato vacÃ­o"}),t.map((s,l)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.5rem",borderBottom:"1px solid #eee"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.img?e.jsx("img",{src:s.img,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"6px"}}):e.jsx("span",{style:{fontSize:"1.5rem"},children:"ðŸ¥£"}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:600},children:[s.carbs,"g carbs"]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#888"},children:[s.name," ",s.weight?`(${s.weight}g)`:""]})]})]}),e.jsx("button",{onClick:()=>d(l),style:{background:"none",border:"none",color:"red",cursor:"pointer",padding:"0.5rem"},children:"âœ•"})]},l))]}),t.length>0&&e.jsx(v,{onClick:u,style:{width:"100%"},children:"ðŸ§® Calcular con Total"})]})}function mt(){const[t,a]=r.useState(0),n=()=>a(i=>i+1);return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Asistente Basal",showBack:!1}),e.jsxs("main",{className:"page",style:{paddingBottom:"90px"},children:[e.jsx(gt,{onRefresh:n}),e.jsx(pt,{},`advice-${t}`),e.jsx(ht,{}),e.jsx(ft,{},`timeline-${t}`)]}),e.jsx(M,{activeTab:"basal"})]})}function gt({onRefresh:t}){const[a,n]=r.useState(""),[i,d]=r.useState(()=>{const b=new Date,k=C=>C<10?"0"+C:C;return`${b.getFullYear()}-${k(b.getMonth()+1)}-${k(b.getDate())}T${k(b.getHours())}:${k(b.getMinutes())}`}),[u,s]=r.useState(""),[l,c]=r.useState(!1),[g,m]=r.useState(null),[p,o]=r.useState(!1),h=async(b=!0)=>{const k=parseFloat(a);if(b&&(isNaN(k)||k<=0))return m({text:"âš ï¸ Dosis requerida.",type:"error"}),!1;if(!isNaN(k)&&k>0)try{const C=new Date(i);return await Ie({dose_u:k,created_at:C.toISOString(),effective_from:C.toISOString().split("T")[0]}),!0}catch(C){return m({text:"Error guardando dosis: "+C.message,type:"error"}),!1}return!0},S=async()=>{o(!0),await h(!0)&&(m({text:"âœ… Dosis guardada.",type:"success"}),n(""),t&&t()),o(!1)},y=async()=>{if(o(!0),!await h(!1)){o(!1);return}m({text:"Consultando Nightscout...",type:"info"});const k=W()||{},C=new Date(i);try{await le({nightscout_url:k.url,nightscout_token:k.token,created_at:C.toISOString()}),m({text:"âœ… Guardado y analizado.",type:"success"}),t&&t()}catch(R){console.warn("Auto Checkin Failed:",R),c(!0);const _=R.message==="[object Object]"?"Desc":R.message;m({text:`âš ï¸ Fallo Auto: ${_}. Usa manual.`,type:"warning"})}o(!1),o(!1)},x=async()=>{const b=parseFloat(u);if(isNaN(b)){m({text:"BG invÃ¡lida",type:"error"});return}o(!0);try{await le({manual_bg:b,manual_trend:"Manual",created_at:new Date(i).toISOString()}),m({text:"âœ… Check-in manual guardado.",type:"success"}),c(!1),s(""),t&&t()}catch(k){m({text:"Error: "+k.message,type:"error"})}finally{o(!1)}},w=async()=>{o(!0),m({text:"Analizando noche (00h-06h)...",type:"info"});try{const b=W()||{};await ae(b),m({text:"âœ… AnÃ¡lisis nocturno completado.",type:"success"}),t&&t()}catch(b){m({text:"Error: "+b.message,type:"error"})}finally{o(!1)}};return e.jsxs(T,{className:"stack",style:{marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1.1rem"},children:"Registrar / Check-in"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.75rem",fontWeight:700,color:"#64748b",display:"block",marginBottom:"0.25rem"},children:"DOSIS (U)"}),e.jsx("input",{type:"number",step:"0.5",placeholder:"0.0",value:a,onChange:b=>n(b.target.value),style:{width:"100%",padding:"0.6rem",fontSize:"1.1rem",border:"1px solid #cbd5e1",borderRadius:"8px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"0.75rem",fontWeight:700,color:"#64748b",display:"block",marginBottom:"0.25rem"},children:"FECHA/HORA"}),e.jsx("input",{type:"datetime-local",value:i,onChange:b=>d(b.target.value),style:{width:"100%",padding:"0.7rem",fontSize:"0.9rem",border:"1px solid #cbd5e1",borderRadius:"8px"}})]})]}),l&&e.jsxs("div",{className:"fade-in",style:{background:"#f8fafc",padding:"1rem",borderRadius:"8px",marginTop:"0.8rem",border:"1px solid #e2e8f0"},children:[e.jsx("label",{style:{fontSize:"0.85rem",fontWeight:700,color:"#475569",display:"block",marginBottom:"0.5rem"},children:"GLUCOSA MANUAL (mg/dL)"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.8rem"},children:[e.jsx("input",{type:"number",placeholder:"Ej: 110",value:u,onChange:b=>s(b.target.value),style:{width:"100%",padding:"0.8rem",fontSize:"1.2rem",border:"1px solid #cbd5e1",borderRadius:"8px",textAlign:"center"}}),e.jsx(v,{onClick:x,disabled:p,style:{width:"100%",padding:"0.8rem"},children:"Guardar"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx(v,{variant:"ghost",onClick:S,disabled:p,style:{border:"1px solid #e2e8f0",flex:1},children:p?"...":"Solo Guardar"}),e.jsx(v,{onClick:y,disabled:p,style:{flex:1.5},children:p?"...":"â˜€ï¸ Al Levantarme"})]}),e.jsx(v,{variant:"secondary",onClick:w,disabled:p,style:{width:"100%"},children:"ðŸŒ™ Analizar Noche (00h-06h)"}),g&&e.jsx("div",{style:{marginTop:"0.5rem",padding:"0.5rem",borderRadius:"6px",fontSize:"0.85rem",textAlign:"center",background:g.type==="error"?"#fee2e2":g.type==="warning"?"#fef3c7":"#dcfce7",color:g.type==="error"?"#991b1b":g.type==="warning"?"#92400e":"#166534"},children:g.text})]})}function pt(){const[t,a]=r.useState(null),[n,i]=r.useState(!0),d=async()=>{try{const c=await Re(3);a(c)}catch(c){a({error:c.message})}finally{i(!1)}};if(r.useEffect(()=>{d()},[]),n)return e.jsx(T,{style:{marginBottom:"1rem",textAlign:"center",color:"#64748b"},children:"Analizando..."});if(!t)return null;let u="#64748b",s="â„¹ï¸";const l=t.message||(t.error?"Error":"");return l.includes("OK")?(u="var(--success)",s="âœ…"):l.includes("hipoglucemias")?(u="var(--danger)",s="ðŸš¨"):(l.includes("alza")||l.includes("baja"))&&(u="var(--warning)",s="âš ï¸"),e.jsxs(T,{style:{marginBottom:"1rem",borderLeft:`4px solid ${u}`},children:[e.jsx("h3",{style:{margin:"0 0 0.5rem 0",fontSize:"1rem"},children:"Estado Basal"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"flex-start"},children:[e.jsx("div",{style:{fontSize:"1.2rem"},children:s}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"#334155",marginBottom:"0.2rem"},children:t.error||t.message}),!t.error&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"#94a3b8"},children:["Confianza: ",e.jsx("span",{style:{textTransform:"uppercase",fontWeight:700},children:t.confidence==="high"?"Alta":t.confidence==="medium"?"Media":"Baja"})]})]})]})]})}function ht(){const[t,a]=r.useState(null),[n,i]=r.useState(!1),d=async u=>{i(!0);try{const s=await Te(u);a(s)}catch(s){alert(typeof s.message=="string"?s.message:JSON.stringify(s))}finally{i(!1)}};return e.jsxs(T,{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem"},children:"Impacto Cambios"}),e.jsx("span",{style:{fontSize:"0.7rem",background:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",color:"#64748b"},children:"Memoria de efecto"})]}),t&&e.jsxs("div",{style:{marginBottom:"1rem",background:"#f8fafc",padding:"1rem",borderRadius:"8px",borderLeft:`4px solid ${t.result==="improved"?"var(--success)":t.result==="worse"?"var(--danger)":"#f59e0b"}`},children:[e.jsx("div",{style:{fontWeight:700,color:t.result==="improved"?"var(--success)":t.result==="worse"?"var(--danger)":"#f59e0b"},children:t.result==="improved"?"âœ… MEJORÃA":t.result==="worse"?"ðŸ“‰ EMPEORAMIENTO":"â“ INSUFICIENTE"}),e.jsx("div",{style:{marginTop:"0.4rem",fontSize:"0.9rem",color:"#334155"},children:t.summary})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx(v,{variant:"secondary",onClick:()=>d(7),disabled:n,style:{flex:1,fontSize:"0.85rem"},children:"ðŸ“Š Evaluar (7 dÃ­as)"}),e.jsx(v,{variant:"ghost",onClick:()=>d(14),disabled:n,style:{flex:1,fontSize:"0.85rem"},children:"14 dÃ­as"})]})]})}function ft(){const[t,a]=r.useState([]),[n,i]=r.useState(!0),d=async()=>{try{const l=await Ae(14);a(l.items||[])}catch(l){console.error(l)}finally{i(!1)}};r.useEffect(()=>{d()},[]);const u=async l=>{if(confirm(`Â¿Analizar noche del ${l}?`))try{const c=W();if(!c)throw new Error("Configurar Nightscout");const g=await ae(c,l);console.log(g);let m="âœ… AnÃ¡lisis Completado.";g.had_hypo?m+=" Se detectÃ³ hipoglucemia.":m+=" Noche estable (OK).",alert(m),d()}catch(c){alert(typeof c.message=="string"?c.message:"Error desconocido al analizar")}},s=async()=>{const l=t.filter(c=>c.night_had_hypo===null);if(l.length===0)return alert("No hay noches pendientes de analizar.");if(confirm(`Se analizarÃ¡n ${l.length} noches pendientes. Esto puede tardar unos segundos. Â¿Continuar?`)){i(!0);try{const c=W();if(!c)throw new Error("Configurar Nightscout");let g=0;for(const m of l)try{await ae(c,m.date),g++}catch(p){console.error(`Error analizando ${m.date}:`,p)}alert(`Proceso finalizado. ${g}/${l.length} noches analizadas.`),d()}catch(c){alert(typeof c.message=="string"?c.message:"Error en proceso masivo"),i(!1)}}};return e.jsxs("section",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,color:"#64748b",fontSize:"1rem"},children:"Historial (14 dÃ­as)"}),t.some(l=>l.night_had_hypo===null)&&e.jsx("button",{onClick:s,style:{fontSize:"0.8rem",padding:"0.4rem 0.8rem",background:"#e0f2fe",color:"#0369a1",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:600},children:"âš¡ Analizar Pendientes"})]}),e.jsx("div",{className:"card",style:{padding:0,overflow:"hidden",border:"1px solid #e2e8f0",borderRadius:"12px"},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",textAlign:"left",borderCollapse:"collapse",fontSize:"0.85rem"},children:[e.jsx("thead",{style:{background:"#f8fafc",color:"#64748b",fontSize:"0.75rem"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.75rem"},children:"Fecha"}),e.jsx("th",{style:{padding:"0.75rem"},children:"Basal"}),e.jsx("th",{style:{padding:"0.75rem"},children:"Despertar"}),e.jsx("th",{style:{padding:"0.75rem"},children:"Noche"})]})}),e.jsxs("tbody",{children:[n&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",style:{textAlign:"center",padding:"1rem"},children:"Cargando..."})}),!n&&t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",style:{textAlign:"center",padding:"1rem"},children:"No hay datos"})}),!n&&t.map((l,c)=>{const m=new Date(l.date).toLocaleDateString(void 0,{weekday:"short",day:"numeric"});return e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"0.75rem",color:"#334155"},children:m}),e.jsx("td",{style:{padding:"0.75rem",fontWeight:700,color:"#3b82f6"},children:l.dose_u?l.dose_u+" U":"-"}),e.jsx("td",{style:{padding:"0.75rem",color:"#334155"},children:l.wake_bg?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:Math.round(l.wake_bg)}),l.wake_trend&&e.jsx("small",{style:{color:"#94a3b8",marginLeft:"4px"},children:l.wake_trend})]}):"--"}),e.jsx("td",{style:{padding:"0.75rem"},children:l.night_had_hypo===!0?e.jsxs("span",{style:{color:"var(--danger)",fontWeight:700},children:["ðŸŒ™ < 70 ",l.night_events_below_70>1?`(${l.night_events_below_70})`:""]}):l.night_had_hypo===!1?e.jsx("span",{style:{color:"var(--success)"},children:"OK"}):e.jsx("button",{onClick:()=>u(l.date),style:{fontSize:"0.7rem",padding:"2px 6px",border:"1px solid #cbd5e1",background:"transparent",borderRadius:"4px",cursor:"pointer"},children:"ðŸ” Analizar"})})]},c)})]})]})})})]})}function xt(){return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Patrones",showBack:!1}),e.jsx("main",{className:"page",style:{paddingBottom:"90px"},children:e.jsx(yt,{})}),e.jsx(M,{activeTab:"patterns"})]})}function yt(){const[t,a]=r.useState(30),[n,i]=r.useState(null),[d,u]=r.useState(!0),[s,l]=r.useState(!1),[c,g]=r.useState(null),m=async o=>{u(!0);try{const h=await Pe(o);i(h)}catch(h){g({text:"Error cargando resumen: "+h.message,type:"error"})}finally{u(!1)}};r.useEffect(()=>{m(t)},[t]);const p=async()=>{l(!0),g({text:"Calculando patrones... espera unos segundos.",type:"info"});try{const o=await De(t);g({text:`AnÃ¡lisis completado: ${o.boluses} bolos analizados.`,type:"success"}),await m(t)}catch(o){g({text:"Error: "+o.message,type:"error"})}finally{l(!1)}};return e.jsxs(T,{children:[e.jsx("h3",{style:{marginTop:0},children:"AnÃ¡lisis Post-Bolo"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsxs("select",{value:t,onChange:o=>a(parseInt(o.target.value)),style:{padding:"0.5rem",borderRadius:"6px",fontSize:"1rem",border:"1px solid #cbd5e1"},children:[e.jsx("option",{value:"14",children:"14 dÃ­as"}),e.jsx("option",{value:"30",children:"30 dÃ­as"}),e.jsx("option",{value:"60",children:"60 dÃ­as"})]}),e.jsx(v,{onClick:p,disabled:s,style:{padding:"0.5rem 1rem",fontSize:"0.9rem"},children:s?"Analizando...":"Recalcular"})]}),c&&e.jsx("div",{style:{marginBottom:"1rem",padding:"0.5rem",borderRadius:"6px",fontSize:"0.9rem",background:c.type==="error"?"#fee2e2":c.type==="success"?"#dcfce7":"#f1f5f9",color:c.type==="error"?"#991b1b":c.type==="success"?"#166534":"#64748b"},children:c.text}),d?e.jsx("div",{className:"spinner",children:"Cargando datos..."}):n?e.jsx(bt,{data:n}):null,n&&n.data_quality&&e.jsxs("div",{style:{marginTop:"2rem",fontSize:"0.8rem",color:"#94a3b8",borderTop:"1px solid #e2e8f0",paddingTop:"1rem"},children:["Calidad de datos: ",n.data_quality.iob_unavailable_events||0," eventos con IOB no disponible (excluidos). Total eventos: ",n.data_quality.total_events||0,"."]})]})}function bt({data:t}){if(!t)return null;const a=["breakfast","lunch","dinner","snack"],n={breakfast:"Desayuno",lunch:"Comida",dinner:"Cena",snack:"Snack"};return e.jsxs("div",{className:"fade-in",children:[t.insights&&t.insights.length>0?e.jsx("ul",{style:{background:"#f0fdf4",padding:"1rem",borderRadius:"8px",border:"1px solid #bbf7d0",marginBottom:"1.5rem",listStylePosition:"inside"},children:t.insights.map((i,d)=>e.jsx("li",{style:{marginBottom:"0.5rem",color:"#166534"},children:e.jsx("strong",{children:i})},d))}):e.jsxs("div",{style:{padding:"1rem",color:"#64748b",textAlign:"center"},children:[e.jsx("div",{style:{fontStyle:"italic",marginBottom:"0.5rem"},children:"No se detectaron patrones claros o faltan datos."}),e.jsx("small",{children:"Se requieren al menos 5 eventos para cada comida. Sigue registrando tus bolos para obtener anÃ¡lisis."})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f8fafc",borderBottom:"2px solid #e2e8f0"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left"},children:"Comida"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"2h"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"3h"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center"},children:"5h"})]})}),e.jsx("tbody",{children:a.map(i=>{const d=t.by_meal?t.by_meal[i]:null;return d?e.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsx("td",{style:{padding:"0.8rem 0.5rem",fontWeight:600},children:n[i]||i}),[2,3,5].map(u=>{const s=d[`${u}h`],l=s?s.short+s.ok+s.over:0;return!s||l<5?e.jsxs("td",{style:{padding:"0.5rem",textAlign:"center",color:"#cbd5e1",fontSize:"0.8rem"},children:["(n=",l,")"]},u):e.jsxs("td",{style:{padding:"0.5rem",textAlign:"center",verticalAlign:"top"},children:[s.short>0&&e.jsxs("span",{className:"chip",style:{background:"#fef3c7",color:"#b45309",border:"1px solid #fcd34d",fontSize:"0.75rem",padding:"2px 4px",borderRadius:"4px",marginRight:"2px"},children:["Corto:",s.short]}),s.over>0&&e.jsxs("span",{className:"chip",style:{background:"#fee2e2",color:"#b91c1c",border:"1px solid #fca5a5",fontSize:"0.75rem",padding:"2px 4px",borderRadius:"4px",marginRight:"2px"},children:["Mucha:",s.over]}),s.ok>0&&e.jsxs("span",{className:"chip",style:{background:"#dcfce7",color:"#15803d",border:"1px solid #86efac",fontSize:"0.75rem",padding:"2px 4px",borderRadius:"4px"},children:["OK:",s.ok]})]},u)})]},i):null})})]})})]})}function jt(){const[t,a]=r.useState("pending");return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Sugerencias",showBack:!1}),e.jsxs("main",{className:"page",style:{paddingBottom:"90px"},children:[e.jsxs("div",{style:{display:"flex",marginBottom:"1.5rem",background:"white",padding:"4px",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[e.jsx("button",{onClick:()=>a("pending"),style:{flex:1,border:"none",background:t==="pending"?"var(--primary-soft)":"transparent",padding:"0.6rem",borderRadius:"8px",fontWeight:600,color:t==="pending"?"var(--primary)":"var(--text-muted)",cursor:"pointer"},children:"Pendientes"}),e.jsx("button",{onClick:()=>a("accepted"),style:{flex:1,border:"none",background:t==="accepted"?"var(--primary-soft)":"transparent",padding:"0.6rem",borderRadius:"8px",fontWeight:600,color:t==="accepted"?"var(--primary)":"var(--text-muted)",cursor:"pointer"},children:"Aceptadas"})]}),t==="pending"?e.jsx(vt,{}):e.jsx(wt,{})]}),e.jsx(M,{activeTab:"suggestions"})]})}function vt(){const[t,a]=r.useState([]),[n,i]=r.useState(!0),[d,u]=r.useState(!1),[s,l]=r.useState(null),c=async()=>{i(!0);try{const y=await pe("pending");a(y||[])}catch(y){l(y.message)}finally{i(!1)}};r.useEffect(()=>{c()},[]);const g=async()=>{u(!0);try{const y=await We(30);y.created>0?alert(`Â¡Ã‰xito! Se han generado ${y.created} nuevas sugerencias.`):alert(`No se encontraron nuevas sugerencias.
Motivos posibles:
- Pocos datos recientes.
- Sin patrones consistentes de error.
- Tu configuraciÃ³n ya estÃ¡ optimizada.`),c()}catch(y){alert(y.message)}finally{u(!1)}},[m,p]=r.useState(!1),[o,h]=r.useState(null),S=y=>{const x=K();if(!x||!x[y.meal_slot]){alert("Error: ConfiguraciÃ³n no encontrada para "+y.meal_slot);return}const w=x[y.meal_slot][y.parameter];h({...y,currentVal:w,newVal:w}),p(!0)};return n&&!t.length?e.jsx("div",{className:"spinner",children:"Cargando sugerencias..."}):e.jsxs("div",{className:"fade-in",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"1rem"},children:e.jsx(v,{onClick:g,disabled:d,style:{fontSize:"0.9rem",padding:"0.5rem 1rem"},children:d?"Generando...":"âœ¨ Generar Nuevas"})}),s&&e.jsx("div",{className:"error",children:s}),t.length===0&&!s&&e.jsx("div",{style:{textAlign:"center",padding:"3rem",color:"#94a3b8",fontStyle:"italic"},children:"No hay sugerencias pendientes."}),e.jsx("div",{className:"stack",children:t.map(y=>e.jsx(St,{item:y,onAccept:()=>S(y),onReject:async()=>{const x=prompt("Â¿Motivo del rechazo?");x!==null&&(await Ee(y.id,x||"Rechazado por usuario"),c())}},y.id))}),m&&o&&e.jsx(Ct,{item:o,onClose:()=>p(!1),onConfirm:async y=>{const x=K();x[o.meal_slot][o.parameter]=y,ee(x),await Le(o.id,"Aceptado por usuario",{meal_slot:o.meal_slot,parameter:o.parameter,old_value:o.currentVal,new_value:y}),p(!1),alert("Cambio aplicado."),c()}})]})}function St({item:t,onAccept:a,onReject:n}){return e.jsxs(T,{style:{borderLeft:"4px solid var(--primary)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"chip",style:{background:"#e0f2fe",color:"#0369a1",textTransform:"capitalize",marginRight:"4px"},children:t.meal_slot}),e.jsx("span",{className:"chip",style:{background:"#f1f5f9",color:"#475569",textTransform:"uppercase"},children:t.parameter})]}),e.jsx("small",{style:{color:"#94a3b8"},children:new Date(t.created_at).toLocaleDateString()})]}),e.jsx("p",{style:{margin:"1rem 0",fontWeight:600,lineHeight:1.4},children:t.reason}),e.jsxs("div",{style:{background:"#f8fafc",padding:"0.8rem",borderRadius:"6px",fontSize:"0.85rem",color:"#64748b",marginBottom:"1rem"},children:[e.jsx("strong",{children:"Evidencia:"})," Ventana ",t.evidence.window,". Ratio incidencia: ",Math.round(t.evidence.ratio*100),"%. (Base ",t.evidence.days," dÃ­as)"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx(v,{variant:"ghost",onClick:n,style:{color:"#b91c1c",border:"1px solid #fecaca",flex:1},children:"Rechazar"}),e.jsx(v,{onClick:a,style:{flex:1},children:"Revisar"})]})]})}function Ct({item:t,onClose:a,onConfirm:n}){const[i,d]=r.useState(t.currentVal),[u,s]=r.useState(!1),l=async()=>{s(!0);try{await n(parseFloat(i))}catch(c){alert("Error: "+c.message),s(!1)}};return e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:999,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"white",padding:"1.5rem",borderRadius:"12px",width:"90%",maxWidth:"400px",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},children:[e.jsx("h3",{style:{marginTop:0,color:"var(--primary)"},children:"Aceptar Cambio"}),e.jsxs("p",{style:{fontSize:"0.9rem",color:"#64748b",marginBottom:"1rem"},children:["EstÃ¡s revisando el ",t.parameter.toUpperCase()," para ",t.meal_slot,"."]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.8rem",fontWeight:600,color:"#64748b"},children:"Valor Actual"}),e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700},children:t.currentVal})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.8rem",fontWeight:600,color:"#64748b"},children:"Nuevo Valor"}),e.jsx(B,{type:"number",step:"0.1",value:i,onChange:c=>d(c.target.value),style:{width:"100%",fontSize:"1.2rem",fontWeight:700}})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx(v,{variant:"ghost",onClick:a,style:{flex:1},children:"Cancelar"}),e.jsx(v,{onClick:l,disabled:u,style:{flex:1},children:u?"Guardando...":"Guardar"})]})]})})}function wt(){const[t,a]=r.useState([]),[n,i]=r.useState([]),[d,u]=r.useState(!0),s=async()=>{u(!0);try{const[g,m]=await Promise.all([pe("accepted"),Fe()]);a(g),i(m)}catch(g){console.error(g)}finally{u(!1)}};r.useEffect(()=>{s()},[]);const l={};n.forEach(g=>l[g.suggestion_id]=g);const c=async g=>{try{const m=await Me(g,7);alert(`EvaluaciÃ³n completada: ${m.summary}`),s()}catch(m){alert(m.message)}};return d?e.jsx("div",{className:"spinner",children:"Cargando historial..."}):t.length?e.jsx("div",{className:"stack fade-in",children:t.map(g=>{const m=l[g.id],p=new Date(g.resolved_at),o=Math.ceil(Math.abs(new Date-p)/(1e3*60*60*24));return e.jsxs(T,{style:{borderLeft:"4px solid #cbd5e1"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"chip",style:{background:"#f1f5f9",color:"#475569",textTransform:"capitalize",marginRight:"4px"},children:g.meal_slot}),e.jsx("span",{className:"chip",style:{background:"#f1f5f9",color:"#475569",textTransform:"uppercase"},children:g.parameter})]}),e.jsx("small",{style:{color:"#94a3b8"},children:p.toLocaleDateString()})]}),e.jsx("p",{style:{fontSize:"0.9rem",color:"#334155",margin:"0.5rem 0"},children:g.resolution_note||"Sin nota"}),m?e.jsxs("div",{style:{marginTop:"1rem",background:"#f8fafc",padding:"0.8rem",borderRadius:"8px",borderLeft:`4px solid ${m.result==="improved"?"var(--success)":m.result==="worse"?"var(--danger)":"#cbd5e1"}`},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:"0.9rem",color:m.result==="improved"?"var(--success)":m.result==="worse"?"var(--danger)":"#64748b"},children:[m.result==="improved"?"âœ…":m.result==="worse"?"âš ï¸":"âž–"," Impacto: ",m.result.toUpperCase()]}),e.jsx("p",{style:{fontSize:"0.85rem",margin:"0.5rem 0 0",color:"#475569"},children:m.summary})]}):e.jsx("div",{style:{marginTop:"1rem"},children:o<7?e.jsxs("div",{style:{background:"#fff7ed",padding:"0.8rem",borderRadius:"8px",border:"1px dashed #fdba74",fontSize:"0.85rem",color:"#c2410c"},children:["ðŸ“‰ Faltan datos para evaluar. ",e.jsxs("small",{children:["(",o,"/7 dÃ­as)"]})]}):e.jsx(v,{variant:"secondary",onClick:()=>c(g.id),style:{fontSize:"0.85rem",color:"var(--primary)",borderColor:"var(--primary)"},children:"ðŸ“Š Evaluar Impacto (7 dÃ­as)"})})]},g.id)})}):e.jsx("div",{style:{textAlign:"center",padding:"3rem",color:"#94a3b8",fontStyle:"italic"},children:"No hay historial de cambios aceptados."})}function kt(){const[t,a]=r.useState(""),[n,i]=r.useState(""),[d,u]=r.useState(!1),[s,l]=r.useState(null),c=async g=>{g.preventDefault(),u(!0),l(null);try{const m=await Oe(t,n);f.token=m.access_token,f.user=m.user,typeof Y=="function"&&Y(f.token,f.user),m.user.needs_password_change?D("#/change-password"):D("#/")}catch(m){l(m.message||"No se pudo iniciar sesiÃ³n")}finally{u(!1)}};return e.jsxs("main",{className:"page narrow",style:{display:"flex",flexDirection:"column",justifyContent:"center",minHeight:"100vh",padding:"1rem"},children:[e.jsx("header",{className:"topbar",style:{justifyContent:"center",marginBottom:"2rem",background:"transparent"},children:e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"900",background:"linear-gradient(135deg, #2563eb, #3b82f6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Bolus AI"})}),e.jsxs(T,{className:"auth-card",style:{padding:"2rem"},children:[e.jsx("h1",{style:{fontSize:"1.5rem",marginBottom:"1.5rem"},children:"Inicia sesiÃ³n"}),e.jsxs("form",{onSubmit:c,className:"stack",children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600},children:"Usuario"}),e.jsx(B,{type:"text",autoComplete:"username",required:!0,value:t,onChange:g=>a(g.target.value),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600},children:"ContraseÃ±a"}),e.jsx(B,{type:"password",autoComplete:"current-password",required:!0,value:n,onChange:g=>i(g.target.value),style:{width:"100%"}})]}),e.jsx(v,{type:"submit",disabled:d,style:{width:"100%",marginTop:"1rem",padding:"0.8rem"},children:d?"Entrando...":"Entrar"}),e.jsx("p",{className:"hint",style:{textAlign:"center",marginTop:"1rem"},children:"Se mantendrÃ¡ la sesiÃ³n."}),s&&e.jsx("div",{className:"error",style:{background:"#fee2e2",color:"#991b1b",padding:"0.8rem",borderRadius:"8px",marginTop:"1rem",textAlign:"center"},children:s})]})]})]})}function _t(){const[t,a]=r.useState(""),[n,i]=r.useState(""),[d,u]=r.useState(!1),[s,l]=r.useState(null),[c,g]=r.useState(!1),m=async p=>{p.preventDefault(),u(!0),l(null),g(!1);try{const o=await he(t,n);f.user=o.user||f.user,typeof Y=="function"&&Y(f.token,f.user),g(!0),setTimeout(()=>D("#/"),1e3)}catch(o){l(o.message||"No se pudo actualizar")}finally{u(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Seguridad",showBack:!0}),e.jsx("main",{className:"page narrow",style:{paddingTop:"2rem"},children:e.jsxs(T,{className:"auth-card",children:[e.jsx("h2",{style:{fontSize:"1.3rem",marginBottom:"1rem"},children:"Cambiar contraseÃ±a"}),e.jsx("p",{className:"hint",style:{marginBottom:"1.5rem"},children:"Introduce tu contraseÃ±a actual y una nueva (mÃ­nimo 8 caracteres)."}),e.jsxs("form",{onSubmit:m,className:"stack",children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600},children:"ContraseÃ±a actual"}),e.jsx(B,{type:"password",autoComplete:"current-password",required:!0,value:t,onChange:p=>a(p.target.value),style:{width:"100%"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:600},children:"Nueva contraseÃ±a"}),e.jsx(B,{type:"password",autoComplete:"new-password",required:!0,minLength:8,value:n,onChange:p=>i(p.target.value),style:{width:"100%"}})]}),e.jsx(v,{type:"submit",disabled:d,style:{width:"100%",marginTop:"1rem"},children:d?"Actualizando...":"Actualizar"}),s&&e.jsx("div",{className:"error",style:{background:"#fee2e2",color:"#991b1b",padding:"0.8rem",borderRadius:"8px",marginTop:"1rem"},children:s}),c&&e.jsx("div",{className:"success",style:{background:"#dcfce7",color:"#166534",padding:"0.8rem",borderRadius:"8px",marginTop:"1rem"},children:"ContraseÃ±a actualizada."})]})]})})]})}function Nt(){const t=Ue(i=>i.user),[a,n]=r.useState("general");return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Mi Perfil",showBack:!0}),e.jsxs("main",{className:"page",style:{padding:"1rem",maxWidth:"600px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1.5rem"},children:[e.jsx(ie,{active:a==="general",onClick:()=>n("general"),children:"General"}),e.jsx(ie,{active:a==="security",onClick:()=>n("security"),children:"Seguridad"})]}),a==="general"&&e.jsx(Bt,{user:t}),a==="security"&&e.jsx(zt,{})]})]})}function ie({active:t,onClick:a,children:n}){return e.jsx("button",{onClick:a,style:{flex:1,padding:"10px",borderRadius:"8px",border:"none",background:t?"var(--primary)":"#e2e8f0",color:t?"white":"#64748b",fontWeight:600},children:n})}function se({value:t,onChange:a,placeholder:n,required:i=!1,minLength:d}){const[u,s]=r.useState(!1);return e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{className:"w-full border rounded p-2",type:u?"text":"password",placeholder:n,value:t,onChange:a,minLength:d,required:i,style:{paddingRight:"40px"}}),e.jsx("button",{type:"button",onClick:()=>s(!u),style:{position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"5px",color:"#64748b",fontSize:"1.2rem"},tabIndex:"-1",children:u?"ðŸ‘ï¸":"ðŸ”’"})]})}function Bt({user:t}){const[a,n]=r.useState(t?.username||""),[i,d]=r.useState(""),[u,s]=r.useState(null),[l,c]=r.useState(!1),g=async m=>{m.preventDefault(),c(!0),s(null);try{await $e(a,i),s({type:"success",text:"Nombre de usuario actualizado."}),d("")}catch(p){s({type:"error",text:p.message})}finally{c(!1)}};return e.jsxs(T,{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"InformaciÃ³n de Cuenta"}),u&&e.jsx("div",{className:`alert ${u.type==="error"?"alert-danger":"alert-success"}`,style:{padding:"10px",borderRadius:"8px",marginBottom:"1rem",background:u.type==="error"?"#fee2e2":"#dcfce7",color:u.type==="error"?"#991b1b":"#166534"},children:u.text}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Nombre de Usuario"}),e.jsx("input",{className:"w-full border rounded p-2",type:"text",value:a,onChange:m=>n(m.target.value),minLength:3,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Cambiar esto actualizarÃ¡ tu historial y configuraciÃ³n automÃ¡ticamente."})]}),e.jsxs("div",{style:{marginTop:"1rem",borderTop:"1px solid #eee",paddingTop:"1rem"},children:[e.jsx("label",{className:"block font-medium mb-1",children:"Confirma tu contraseÃ±a actual"}),e.jsx(se,{placeholder:"ContraseÃ±a actual",value:i,onChange:m=>d(m.target.value),required:!0})]}),e.jsx(v,{type:"submit",disabled:l||!i,style:{width:"100%",marginTop:"1rem"},children:l?"Guardando...":"Guardar Cambios"})]})]})}function zt(){const[t,a]=r.useState(""),[n,i]=r.useState(""),[d,u]=r.useState(null),[s,l]=r.useState(!1),c=async g=>{g.preventDefault(),l(!0),u(null);try{await he(t,n),u({type:"success",text:"ContraseÃ±a actualizada correctamente."}),a(""),i("")}catch(m){u({type:"error",text:m.message})}finally{l(!1)}};return e.jsxs(T,{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Cambiar ContraseÃ±a"}),d&&e.jsx("div",{className:`alert ${d.type==="error"?"alert-danger":"alert-success"}`,style:{padding:"10px",borderRadius:"8px",marginBottom:"1rem",background:d.type==="error"?"#fee2e2":"#dcfce7",color:d.type==="error"?"#991b1b":"#166534"},children:d.text}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"ContraseÃ±a Actual"}),e.jsx(se,{value:t,onChange:g=>a(g.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Nueva ContraseÃ±a"}),e.jsx(se,{value:n,onChange:g=>i(g.target.value),minLength:8,required:!0})]}),e.jsx(v,{type:"submit",disabled:s,style:{width:"100%",marginTop:"1rem"},children:s?"Actualizando...":"Actualizar ContraseÃ±a"})]})]})}const Rt={favorites:He,history:Ve,settings:Je,home:nt,bolus:lt,scan:ot,basal:mt,patterns:xt,"nightscout-settings":qe,login:kt,"change-password":_t,suggestions:jt,profile:Nt};let q=null;function At(t,a="app"){const n=document.getElementById(a);if(!n)return;const i=Rt[t];if(!i){n.innerHTML=`<div class="error">React Component '${t}' not found</div>`;return}try{q&&(q.unmount(),q=null),n.innerHTML="",q=Ge.createRoot(n),q.render(e.jsx(ge.StrictMode,{children:e.jsx(i,{})}))}catch(d){console.error("React Mount Error:",d),n.innerHTML=`<div class="error">React Crash: ${d.message}</div>`}}export{At as mountReactPage};
